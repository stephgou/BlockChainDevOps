{"source":2,"revision":50,"description":null,"createdBy":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"createdOn":"2018-12-01T16:18:58.140Z","modifiedBy":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"modifiedOn":"2018-12-05T15:34:27.347Z","isDeleted":false,"variables":{"consortium_global_integ":{"value":"consortium_global_integ"},"consortium_global_production":{"value":"consortium_global_production"},"consortium_global_staging":{"value":"consortium_global_staging"},"consortium_member_integ":{"value":"consortium_member_integ"},"contractsContainerName":{"value":"smartcontracts"},"contractsZipName":{"value":"smartcontracts.zip"}},"variableGroups":[1],"environments":[{"id":11,"name":"Member Dev","rank":1,"owner":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":33}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":38},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":39}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"artifactItems":[],"alias":"BlockchainCI","artifactType":"Build","artifactDownloadMode":"All"}]},"queueId":98,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Run on agent","refName":null,"workflowTasks":[{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Inialize Release variables","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(System.DefaultWorkingDirectory)","workingFolder":"","inlineScript":"Param(\n     [string]$defaultDirectory)\n\n$buildDrop = \"$defaultDirectory\\BlockchainCI\\drop\"\nWrite-Host $buildDrop\nWrite-Host \"##vso[task.setvariable variable=buildDrop;]$buildDrop\" ","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"Extract Application and tools files ","refName":"ExtractFiles_5","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(applicationName).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Check if new build contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/check_if_build_contract.ps1","arguments":"-dropFolder $(buildDrop)","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Display build variable","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(triggerByBuild)","workingFolder":"","inlineScript":"Param(\n     [string]$triggerByBuild)\n\nWrite-Host \"$triggerByBuild\"\nWrite-Host $triggerByBuild\n","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"SC - Extract Build files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(Build.BuildId).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"SC - Deploy Contracts","refName":"PowerShell_8","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"-applicationDirectory \"deploy/$(applicationName)\" -network \"$(consortium_member_integ)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory,\n     [string]$network)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network $network --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"SC -Truffle Test with new contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/test_contract.ps1","arguments":"-network \"$(consortium_member_integ)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"SC - Archive last version of json contracts","refName":"ArchiveFiles_11","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build/contracts","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","replaceExistingArchive":"true"}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"2.*","name":"SC - Save last version of json contracts","refName":"AzureFileCopy_12","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(storageAccountName)","ContainerName":"$(contractsContainerName)","BlobPrefix":"","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArgumentsForBlobCopy":"","AdditionalArgumentsForVMCopy":"","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Build the Web Pack from App and contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"AC - Get last version json contracts from Azure storage","refName":"AzurePowerShell_13","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","ScriptType":"FilePath","ScriptPath":"deploy/$(ApplicationName)/devops/get_contract_latest_version.ps1","Inline":"Param(\n     [string]$resourceGroup,\n     [string]$storageAccount,\n     [string]$container,\n     [string]$zip)\nWrite-Host $resourceGroup + \" \" + $container + \"  \" + zip\nNew-Item -ItemType directory -Path $(System.DefaultWorkingDirectory)/$container\n$storage = Get-AzureRmStorageAccount -ResourceGroupName $resourceGroup -Name $storageAccount\n$storage.Context | Get-AzureStorageBlobContent -Container $container -Blob $zip -Destination $(System.DefaultWorkingDirectory)/$container/$zip","ScriptArguments":"-resourceGroup \"$(resourceGroupName)\" -storageAccount \"$(storageAccountName)\" -directory \"$(System.DefaultWorkingDirectory)\" -container \"$(contractsContainerName)\" -zip \"$(consortium_member_integ)_$(contractsZipName)\"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"OtherVersion","CustomTargetAzurePs":"6.7.0"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"AC - Extract last version json contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"archiveFilePatterns":"$(System.DefaultWorkingDirectory)/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Replace json contracts with last version json contracts","refName":"PowerShell_15","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"","inlineScript":"$sourceFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(contractsContainerName)\"\n\n$destinationFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(applicationName)\\build\\contracts\"\nRemove-Item \"$destinationFolder\\*\"\n\nGet-ChildItem -Recurse $sourceFolder | Copy-Item -Destination $destinationFolder","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Build the Web Pack from App and archived contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Update network config","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/update_network_config.ps1","arguments":"-network \"$(consortium_member_integ)\" -directory \"deploy/$(ApplicationName)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"Archive Web Pack for App Service","refName":"ArchiveFiles_16","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","replaceExistingArchive":"true"}},{"environment":{},"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"3.*","name":"Deploy Web Pack on Azure App Service","refName":"AzureRMWebAppDeployment_17","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":null,"overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","WebAppKind":"app","WebAppName":"BlockChainDev","DeployToSlotFlag":"false","ResourceGroupName":"","SlotName":"","ImageSource":"Registry","AzureContainerRegistry":"","AzureContainerRegistryLoginServer":"","AzureContainerRegistryImage":"","AzureContainerRegistryTag":"","DockerRepositoryAccess":"public","RegistryConnectedServiceName":"","PrivateRegistryImage":"","PrivateRegistryTag":"","DockerNamespace":"","DockerRepository":"","DockerImageTag":"$(Build.BuildId)","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","BuiltinLinuxPackage":"$(System.DefaultWorkingDirectory)/**/*.zip","RuntimeStack":"","StartupCommand":"","WebAppUri":"","ScriptType":"","InlineScript":"","ScriptPath":"","GenerateWebConfig":"false","WebConfigParameters":"-Handler iisnode -NodeStartFile app.js -appType node","AppSettings":"","ConfigurationSettings":"","TakeAppOfflineFlag":"true","UseWebDeploy":"false","SetParametersFile":"","RemoveAdditionalFilesFlag":"false","ExcludeFilesFromAppDataFlag":"false","AdditionalArguments":"","RenameFilesFlag":"true","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":""}},{"environment":{},"taskId":"f045e430-8704-11e6-968f-e717e6411619","version":"0.*","name":"Restart WebPack on Azure App Service","refName":"AzureAppServiceManage_18","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","Action":"Restart Azure App Service","WebAppName":"BlockChainDev","SpecifySlot":"false","ResourceGroupName":"","SourceSlot":"","SwapWithProduction":"true","TargetSlot":"","PreserveVnet":"false","Slot":"production","ExtensionsList":"","OutputVariable":"","AppInsightsResourceGroupName":"","ApplicationInsightsResourceName":"","ApplicationInsightsWebTestName":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"ReleaseStarted","conditionType":1,"value":""}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":226,"url":"https://stephg.vsrm.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_apis/Release/releases/226","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://stephg.vsrm.visualstudio.com/_apis/public/Release/badge/5117ca05-cbc2-44e7-b982-94534759da42/4/11"},{"id":15,"name":"Member QA","rank":2,"owner":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"id":45}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":50},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":51}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"artifactItems":[],"alias":"BlockchainCI","artifactType":"Build","artifactDownloadMode":"All"}]},"queueId":98,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Run on agent","refName":null,"workflowTasks":[{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Inialize Release variables","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(System.DefaultWorkingDirectory)","workingFolder":"","inlineScript":"Param(\n     [string]$defaultDirectory)\n\n$buildDrop = \"$defaultDirectory\\BlockchainCI\\drop\"\nWrite-Host $buildDrop\nWrite-Host \"##vso[task.setvariable variable=buildDrop;]$buildDrop\" ","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"Extract Application and tools files ","refName":"ExtractFiles_5","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(applicationName).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Check if new build contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/check_if_build_contract.ps1","arguments":"-dropFolder $(buildDrop)","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Display build variable","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(triggerByBuild)","workingFolder":"","inlineScript":"Param(\n     [string]$triggerByBuild)\n\nWrite-Host \"$triggerByBuild\"\nWrite-Host $triggerByBuild\n","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"SC - Extract Build files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(Build.BuildId).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"SC - Deploy Contracts","refName":"PowerShell_8","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"-applicationDirectory \"deploy/$(applicationName)\" -network \"$(consortium_member_integ)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory,\n     [string]$network)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network $network --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"SC -Truffle Test with new contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/test_contract.ps1","arguments":"-network \"$(consortium_member_integ)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"SC - Archive last version of json contracts","refName":"ArchiveFiles_11","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build/contracts","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","replaceExistingArchive":"true"}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"2.*","name":"SC - Save last version of json contracts","refName":"AzureFileCopy_12","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(storageAccountName)","ContainerName":"$(contractsContainerName)","BlobPrefix":"","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArgumentsForBlobCopy":"","AdditionalArgumentsForVMCopy":"","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Build the Web Pack from App and contracts copy","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"AC - Get last version json contracts from Azure storage","refName":"AzurePowerShell_13","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","ScriptType":"FilePath","ScriptPath":"deploy/$(ApplicationName)/devops/get_contract_latest_version.ps1","Inline":"Param(\n     [string]$resourceGroup,\n     [string]$storageAccount,\n     [string]$container,\n     [string]$zip)\nWrite-Host $resourceGroup + \" \" + $container + \"  \" + zip\nNew-Item -ItemType directory -Path $(System.DefaultWorkingDirectory)/$container\n$storage = Get-AzureRmStorageAccount -ResourceGroupName $resourceGroup -Name $storageAccount\n$storage.Context | Get-AzureStorageBlobContent -Container $container -Blob $zip -Destination $(System.DefaultWorkingDirectory)/$container/$zip","ScriptArguments":"-resourceGroup \"$(resourceGroupName)\" -storageAccount \"$(storageAccountName)\" -directory \"$(System.DefaultWorkingDirectory)\" -container \"$(contractsContainerName)\" -zip \"$(consortium_member_integ)_$(contractsZipName)\"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"OtherVersion","CustomTargetAzurePs":"6.7.0"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"AC - Extract last version json contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"archiveFilePatterns":"$(System.DefaultWorkingDirectory)/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Replace json contracts with last version json contracts","refName":"PowerShell_15","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"","inlineScript":"$sourceFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(contractsContainerName)\"\n\n$destinationFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(applicationName)\\build\\contracts\"\nRemove-Item \"$destinationFolder\\*\"\n\nGet-ChildItem -Recurse $sourceFolder | Copy-Item -Destination $destinationFolder","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Build the Web Pack from App and archived contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Update network config","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/update_network_config.ps1","arguments":"-network \"$(consortium_member_integ)\" -directory \"deploy/$(ApplicationName)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"Archive Web Pack for App Service","refName":"ArchiveFiles_16","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","replaceExistingArchive":"true"}},{"environment":{},"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"3.*","name":"Deploy Web Pack on Azure App Service","refName":"AzureRMWebAppDeployment_17","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":null,"overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","WebAppKind":"app","WebAppName":"BlockChainDev","DeployToSlotFlag":"false","ResourceGroupName":"","SlotName":"","ImageSource":"Registry","AzureContainerRegistry":"","AzureContainerRegistryLoginServer":"","AzureContainerRegistryImage":"","AzureContainerRegistryTag":"","DockerRepositoryAccess":"public","RegistryConnectedServiceName":"","PrivateRegistryImage":"","PrivateRegistryTag":"","DockerNamespace":"","DockerRepository":"","DockerImageTag":"$(Build.BuildId)","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","BuiltinLinuxPackage":"$(System.DefaultWorkingDirectory)/**/*.zip","RuntimeStack":"","StartupCommand":"","WebAppUri":"","ScriptType":"","InlineScript":"","ScriptPath":"","GenerateWebConfig":"false","WebConfigParameters":"-Handler iisnode -NodeStartFile app.js -appType node","AppSettings":"","ConfigurationSettings":"","TakeAppOfflineFlag":"true","UseWebDeploy":"false","SetParametersFile":"","RemoveAdditionalFilesFlag":"false","ExcludeFilesFromAppDataFlag":"false","AdditionalArguments":"","RenameFilesFlag":"true","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":""}},{"environment":{},"taskId":"f045e430-8704-11e6-968f-e717e6411619","version":"0.*","name":"Restart WebPack on Azure App Service","refName":"AzureAppServiceManage_18","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","Action":"Restart Azure App Service","WebAppName":"BlockChainDev","SpecifySlot":"false","ResourceGroupName":"","SourceSlot":"","SwapWithProduction":"true","TargetSlot":"","PreserveVnet":"false","Slot":"production","ExtensionsList":"","OutputVariable":"","AppInsightsResourceGroupName":"","ApplicationInsightsResourceName":"","ApplicationInsightsWebTestName":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"Member Dev","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":226,"url":"https://stephg.vsrm.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_apis/Release/releases/226","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://stephg.vsrm.visualstudio.com/_apis/public/Release/badge/5117ca05-cbc2-44e7-b982-94534759da42/4/15"},{"id":16,"name":"Member Production","rank":3,"owner":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"id":46}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":49},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":52}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"artifactItems":[],"alias":"BlockchainCI","artifactType":"Build","artifactDownloadMode":"All"}]},"queueId":98,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Run on agent","refName":null,"workflowTasks":[{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Inialize Release variables","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(System.DefaultWorkingDirectory)","workingFolder":"","inlineScript":"Param(\n     [string]$defaultDirectory)\n\n$buildDrop = \"$defaultDirectory\\BlockchainCI\\drop\"\nWrite-Host $buildDrop\nWrite-Host \"##vso[task.setvariable variable=buildDrop;]$buildDrop\" ","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"Extract Application and tools files ","refName":"ExtractFiles_5","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(applicationName).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Check if new build contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/check_if_build_contract.ps1","arguments":"-dropFolder $(buildDrop)","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Display build variable","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(triggerByBuild)","workingFolder":"","inlineScript":"Param(\n     [string]$triggerByBuild)\n\nWrite-Host \"$triggerByBuild\"\nWrite-Host $triggerByBuild\n","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"SC - Extract Build files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(Build.BuildId).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"SC - Deploy Contracts","refName":"PowerShell_8","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"-applicationDirectory \"deploy/$(applicationName)\" -network \"$(consortium_member_integ)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory,\n     [string]$network)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network $network --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"SC - Archive last version of json contracts","refName":"ArchiveFiles_11","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build/contracts","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","replaceExistingArchive":"true"}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"2.*","name":"SC - Save last version of json contracts","refName":"AzureFileCopy_12","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(storageAccountName)","ContainerName":"$(contractsContainerName)","BlobPrefix":"","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArgumentsForBlobCopy":"","AdditionalArgumentsForVMCopy":"","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Build the Web Pack from App and contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"AC - Get last version json contracts from Azure storage","refName":"AzurePowerShell_13","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","ScriptType":"FilePath","ScriptPath":"deploy/$(ApplicationName)/devops/get_contract_latest_version.ps1","Inline":"Param(\n     [string]$resourceGroup,\n     [string]$storageAccount,\n     [string]$container,\n     [string]$zip)\nWrite-Host $resourceGroup + \" \" + $container + \"  \" + zip\nNew-Item -ItemType directory -Path $(System.DefaultWorkingDirectory)/$container\n$storage = Get-AzureRmStorageAccount -ResourceGroupName $resourceGroup -Name $storageAccount\n$storage.Context | Get-AzureStorageBlobContent -Container $container -Blob $zip -Destination $(System.DefaultWorkingDirectory)/$container/$zip","ScriptArguments":"-resourceGroup \"$(resourceGroupName)\" -storageAccount \"$(storageAccountName)\" -directory \"$(System.DefaultWorkingDirectory)\" -container \"$(contractsContainerName)\" -zip \"$(consortium_member_integ)_$(contractsZipName)\"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"OtherVersion","CustomTargetAzurePs":"6.7.0"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"AC - Extract last version json contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"archiveFilePatterns":"$(System.DefaultWorkingDirectory)/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Replace json contracts with last version json contracts","refName":"PowerShell_15","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"","inlineScript":"$sourceFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(contractsContainerName)\"\n\n$destinationFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(applicationName)\\build\\contracts\"\nRemove-Item \"$destinationFolder\\*\"\n\nGet-ChildItem -Recurse $sourceFolder | Copy-Item -Destination $destinationFolder","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Build the Web Pack from App and archived contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Update network config","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/update_network_config.ps1","arguments":"-network \"$(consortium_member_integ)\" -directory \"deploy/$(ApplicationName)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"Archive Web Pack for App Service","refName":"ArchiveFiles_16","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","replaceExistingArchive":"true"}},{"environment":{},"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"3.*","name":"Deploy Web Pack on Azure App Service","refName":"AzureRMWebAppDeployment_17","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":null,"overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","WebAppKind":"app","WebAppName":"BlockChainDev","DeployToSlotFlag":"false","ResourceGroupName":"","SlotName":"","ImageSource":"Registry","AzureContainerRegistry":"","AzureContainerRegistryLoginServer":"","AzureContainerRegistryImage":"","AzureContainerRegistryTag":"","DockerRepositoryAccess":"public","RegistryConnectedServiceName":"","PrivateRegistryImage":"","PrivateRegistryTag":"","DockerNamespace":"","DockerRepository":"","DockerImageTag":"$(Build.BuildId)","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","BuiltinLinuxPackage":"$(System.DefaultWorkingDirectory)/**/*.zip","RuntimeStack":"","StartupCommand":"","WebAppUri":"","ScriptType":"","InlineScript":"","ScriptPath":"","GenerateWebConfig":"false","WebConfigParameters":"-Handler iisnode -NodeStartFile app.js -appType node","AppSettings":"","ConfigurationSettings":"","TakeAppOfflineFlag":"true","UseWebDeploy":"false","SetParametersFile":"","RemoveAdditionalFilesFlag":"false","ExcludeFilesFromAppDataFlag":"false","AdditionalArguments":"","RenameFilesFlag":"true","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":""}},{"environment":{},"taskId":"f045e430-8704-11e6-968f-e717e6411619","version":"0.*","name":"Restart WebPack on Azure App Service","refName":"AzureAppServiceManage_18","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","Action":"Restart Azure App Service","WebAppName":"BlockChainDev","SpecifySlot":"false","ResourceGroupName":"","SourceSlot":"","SwapWithProduction":"true","TargetSlot":"","PreserveVnet":"false","Slot":"production","ExtensionsList":"","OutputVariable":"","AppInsightsResourceGroupName":"","ApplicationInsightsResourceName":"","ApplicationInsightsWebTestName":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"Member QA","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":221,"url":"https://stephg.vsrm.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_apis/Release/releases/221","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://stephg.vsrm.visualstudio.com/_apis/public/Release/badge/5117ca05-cbc2-44e7-b982-94534759da42/4/16"},{"id":17,"name":"Global Production","rank":4,"owner":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"variables":{},"variableGroups":[],"preDeployApprovals":{"approvals":[{"rank":1,"isAutomated":false,"isNotificationOn":false,"approver":{"displayName":"Stéphane Goudeau","url":"https://app.vssps.visualstudio.com/A6ca1a57e-609c-4abd-9c65-50d4606b94ee/_apis/Identities/cb1e718a-74f5-4341-b7d9-3d124083c504","_links":{"avatar":{"href":"https://stephg.visualstudio.com/_apis/GraphProfile/MemberAvatars/aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"}},"id":"cb1e718a-74f5-4341-b7d9-3d124083c504","uniqueName":"stephgou@microsoft.com","imageUrl":"https://stephg.visualstudio.com/_api/_common/identityImage?id=cb1e718a-74f5-4341-b7d9-3d124083c504","descriptor":"aad.MDBkMDM2ZWQtNzJkZi03ZGYzLThjZTAtZjAzMGU1NWY5YmM4"},"id":47}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":true,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":1}},"deployStep":{"id":48},"postDeployApprovals":{"approvals":[{"rank":1,"isAutomated":true,"isNotificationOn":false,"id":53}],"approvalOptions":{"requiredApproverCount":null,"releaseCreatorCanBeApprover":false,"autoTriggeredAndPreviousEnvironmentApprovedCanBeSkipped":false,"enforceIdentityRevalidation":false,"timeoutInMinutes":0,"executionOrder":2}},"deployPhases":[{"deploymentInput":{"parallelExecution":{"parallelExecutionType":0},"skipArtifactsDownload":false,"artifactsDownloadInput":{"downloadInputs":[{"artifactItems":[],"alias":"BlockchainCI","artifactType":"Build","artifactDownloadMode":"All"}]},"queueId":98,"demands":[],"enableAccessToken":false,"timeoutInMinutes":0,"jobCancelTimeoutInMinutes":1,"condition":"succeeded()","overrideInputs":{}},"rank":1,"phaseType":1,"name":"Run on agent","refName":null,"workflowTasks":[{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Inialize Release variables","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(System.DefaultWorkingDirectory)","workingFolder":"","inlineScript":"Param(\n     [string]$defaultDirectory)\n\n$buildDrop = \"$defaultDirectory\\BlockchainCI\\drop\"\nWrite-Host $buildDrop\nWrite-Host \"##vso[task.setvariable variable=buildDrop;]$buildDrop\" ","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"Extract Application and tools files ","refName":"ExtractFiles_5","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(applicationName).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Check if new build contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/check_if_build_contract.ps1","arguments":"-dropFolder $(buildDrop)","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Display build variable","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"$(triggerByBuild)","workingFolder":"","inlineScript":"Param(\n     [string]$triggerByBuild)\n\nWrite-Host \"$triggerByBuild\"\nWrite-Host $triggerByBuild\n","failOnStandardError":"true"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"SC - Extract Build files","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"archiveFilePatterns":"$(buildDrop)\\$(Build.BuildId).zip","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"SC - Deploy Contracts","refName":"PowerShell_8","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"-applicationDirectory \"deploy/$(applicationName)\" -network \"$(consortium_member_integ)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory,\n     [string]$network)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network $network --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"SC - Archive last version of json contracts","refName":"ArchiveFiles_11","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build/contracts","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","replaceExistingArchive":"true"}},{"environment":{},"taskId":"eb72cb01-a7e5-427b-a8a1-1b31ccac8a43","version":"2.*","name":"SC - Save last version of json contracts","refName":"AzureFileCopy_12","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'SmartContract'))","inputs":{"SourcePath":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","Destination":"AzureBlob","StorageAccount":"","StorageAccountRM":"$(storageAccountName)","ContainerName":"$(contractsContainerName)","BlobPrefix":"","EnvironmentName":"","EnvironmentNameRM":"","ResourceFilteringMethod":"machineNames","MachineNames":"","vmsAdminUserName":"","vmsAdminPassword":"","TargetPath":"","AdditionalArgumentsForBlobCopy":"","AdditionalArgumentsForVMCopy":"","enableCopyPrerequisites":"false","CopyFilesInParallel":"true","CleanTargetBeforeCopy":"false","skipCACheck":"true","outputStorageUri":"","outputStorageContainerSasToken":""}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Build the Web Pack from App and contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Build the Web Pack from App and archived contracts","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"filePath","scriptName":"deploy/EthereumDApp/devops/build_contract.ps1","arguments":"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#install default builder for truffle\nnpm install truffle-default-builder --save","failOnStandardError":"false"}},{"environment":{},"taskId":"72a1931b-effb-4d2e-8fd8-f8472a07cb62","version":"3.*","name":"AC - Get last version json contracts from Azure storage","refName":"AzurePowerShell_13","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"ConnectedServiceNameSelector":"ConnectedServiceNameARM","ConnectedServiceName":"","ConnectedServiceNameARM":"eed67a49-ccb9-46cf-992f-786968c274f2","ScriptType":"FilePath","ScriptPath":"deploy/$(ApplicationName)/devops/get_contract_latest_version.ps1","Inline":"Param(\n     [string]$resourceGroup,\n     [string]$storageAccount,\n     [string]$container,\n     [string]$zip)\nWrite-Host $resourceGroup + \" \" + $container + \"  \" + zip\nNew-Item -ItemType directory -Path $(System.DefaultWorkingDirectory)/$container\n$storage = Get-AzureRmStorageAccount -ResourceGroupName $resourceGroup -Name $storageAccount\n$storage.Context | Get-AzureStorageBlobContent -Container $container -Blob $zip -Destination $(System.DefaultWorkingDirectory)/$container/$zip","ScriptArguments":"-resourceGroup \"$(resourceGroupName)\" -storageAccount \"$(storageAccountName)\" -directory \"$(System.DefaultWorkingDirectory)\" -container \"$(contractsContainerName)\" -zip \"$(consortium_member_integ)_$(contractsZipName)\"","errorActionPreference":"stop","FailOnStandardError":"false","TargetAzurePs":"OtherVersion","CustomTargetAzurePs":"6.7.0"}},{"environment":{},"taskId":"5e1e3830-fbfb-11e5-aab1-090c92bc4988","version":"1.*","name":"AC - Extract last version json contract","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"archiveFilePatterns":"$(System.DefaultWorkingDirectory)/$(contractsContainerName)/$(consortium_member_integ)_$(contractsZipName)","destinationFolder":"$(System.DefaultWorkingDirectory)/deploy/$(contractsContainerName)","cleanDestinationFolder":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"AC - Replace json contracts with last version json contracts","refName":"PowerShell_15","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"and(succeeded(), in(variables['triggerByBuild'], 'AppCode'))","inputs":{"scriptType":"inlineScript","scriptName":"","arguments":"","workingFolder":"","inlineScript":"$sourceFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(contractsContainerName)\"\n\n$destinationFolder = \"$(System.DefaultWorkingDirectory)\\deploy\\$(applicationName)\\build\\contracts\"\nRemove-Item \"$destinationFolder\\*\"\n\nGet-ChildItem -Recurse $sourceFolder | Copy-Item -Destination $destinationFolder","failOnStandardError":"true"}},{"environment":{},"taskId":"e213ff0f-5d5c-4791-802d-52ea3e7be1f1","version":"1.*","name":"Update network config","refName":"","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"scriptType":"filePath","scriptName":"deploy/$(ApplicationName)/devops/update_network_config.ps1","arguments":"-network \"$(consortium_member_integ)\" -directory \"deploy/$(ApplicationName)\"","workingFolder":"","inlineScript":"Param(\n     [string]$applicationDirectory\n)\n\ndir\ncd $applicationDirectory\ndir\n\n#Deploy Contracts on Dev Blockchain\ntruffle migrate --network production --reset","failOnStandardError":"true"}},{"environment":{},"taskId":"d8b84976-e99a-4b86-b885-4849694435b0","version":"1.*","name":"Archive Web Pack for App Service","refName":"ArchiveFiles_16","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"rootFolder":"$(System.DefaultWorkingDirectory)/deploy/$(applicationName)/build","includeRootFolder":"false","archiveType":"default","tarCompression":"gz","archiveFile":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","replaceExistingArchive":"true"}},{"environment":{},"taskId":"497d490f-eea7-4f2b-ab94-48d9c1acdcb1","version":"3.*","name":"Deploy Web Pack on Azure App Service","refName":"AzureRMWebAppDeployment_17","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":null,"overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","WebAppKind":"app","WebAppName":"BlockChainDev","DeployToSlotFlag":"false","ResourceGroupName":"","SlotName":"","ImageSource":"Registry","AzureContainerRegistry":"","AzureContainerRegistryLoginServer":"","AzureContainerRegistryImage":"","AzureContainerRegistryTag":"","DockerRepositoryAccess":"public","RegistryConnectedServiceName":"","PrivateRegistryImage":"","PrivateRegistryTag":"","DockerNamespace":"","DockerRepository":"","DockerImageTag":"$(Build.BuildId)","VirtualApplication":"","Package":"$(System.DefaultWorkingDirectory)/appservice/$(Build.BuildId).zip","BuiltinLinuxPackage":"$(System.DefaultWorkingDirectory)/**/*.zip","RuntimeStack":"","StartupCommand":"","WebAppUri":"","ScriptType":"","InlineScript":"","ScriptPath":"","GenerateWebConfig":"false","WebConfigParameters":"-Handler iisnode -NodeStartFile app.js -appType node","AppSettings":"","ConfigurationSettings":"","TakeAppOfflineFlag":"true","UseWebDeploy":"false","SetParametersFile":"","RemoveAdditionalFilesFlag":"false","ExcludeFilesFromAppDataFlag":"false","AdditionalArguments":"","RenameFilesFlag":"true","XmlTransformation":"false","XmlVariableSubstitution":"false","JSONFiles":""}},{"environment":{},"taskId":"f045e430-8704-11e6-968f-e717e6411619","version":"0.*","name":"Restart WebPack on Azure App Service","refName":"AzureAppServiceManage_18","enabled":true,"alwaysRun":false,"continueOnError":false,"timeoutInMinutes":0,"definitionType":"task","overrideInputs":{},"condition":"succeeded()","inputs":{"ConnectedServiceName":"eed67a49-ccb9-46cf-992f-786968c274f2","Action":"Restart Azure App Service","WebAppName":"BlockChainDev","SpecifySlot":"false","ResourceGroupName":"","SourceSlot":"","SwapWithProduction":"true","TargetSlot":"","PreserveVnet":"false","Slot":"production","ExtensionsList":"","OutputVariable":"","AppInsightsResourceGroupName":"","ApplicationInsightsResourceName":"","ApplicationInsightsWebTestName":""}}]}],"environmentOptions":{"emailNotificationType":"OnlyOnFailure","emailRecipients":"release.environment.owner;release.creator","skipArtifactsDownload":false,"timeoutInMinutes":0,"enableAccessToken":false,"publishDeploymentStatus":true,"badgeEnabled":false,"autoLinkWorkItems":false,"pullRequestDeploymentEnabled":false},"demands":[],"conditions":[{"name":"Member QA","conditionType":2,"value":"4"}],"executionPolicy":{"concurrencyCount":0,"queueDepthCount":0},"schedules":[],"currentRelease":{"id":221,"url":"https://stephg.vsrm.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_apis/Release/releases/221","_links":{}},"retentionPolicy":{"daysToKeep":30,"releasesToKeep":3,"retainBuild":true},"processParameters":{},"properties":{},"preDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"postDeploymentGates":{"id":0,"gatesOptions":null,"gates":[]},"environmentTriggers":[],"badgeUrl":"https://stephg.vsrm.visualstudio.com/_apis/public/Release/badge/5117ca05-cbc2-44e7-b982-94534759da42/4/17"}],"artifacts":[{"sourceId":"5117ca05-cbc2-44e7-b982-94534759da42:75","type":"Build","alias":"BlockchainCI","definitionReference":{"artifactSourceDefinitionUrl":{"id":"https://stephg.visualstudio.com/_permalink/_build/index?collectionId=939d0031-b10c-41ee-a508-8c20b43f5076&projectId=5117ca05-cbc2-44e7-b982-94534759da42&definitionId=75","name":""},"defaultVersionBranch":{"id":"","name":""},"defaultVersionSpecific":{"id":"","name":""},"defaultVersionTags":{"id":"","name":""},"defaultVersionType":{"id":"latestType","name":"Latest"},"definition":{"id":"75","name":"Blockchain CI"},"definitions":{"id":"","name":""},"IsMultiDefinitionType":{"id":"False","name":"False"},"project":{"id":"5117ca05-cbc2-44e7-b982-94534759da42","name":"Blockchain DevOps"},"repository":{"id":"b2306750-8314-4335-9987-eef31d9f30e7","name":"Blockchain DevOps"}},"isPrimary":true,"isRetained":false}],"triggers":[{"artifactAlias":"BlockchainCI","triggerConditions":[],"triggerType":1}],"releaseNameFormat":"Release-$(rev:r)","tags":[],"properties":{"DefinitionCreationSource":{"$type":"System.String","$value":"Other"}},"id":4,"name":"Blockchain CD","path":"\\","projectReference":null,"url":"https://stephg.vsrm.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_apis/Release/definitions/4","_links":{"self":{"href":"https://stephg.vsrm.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_apis/Release/definitions/4"},"web":{"href":"https://stephg.visualstudio.com/5117ca05-cbc2-44e7-b982-94534759da42/_release?definitionId=4"}}}